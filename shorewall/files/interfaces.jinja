# !!! FILE MANAGED BY SALT !!!
#
# Shorewall version {{ pkg_version }} - Sample Interfaces File for one-interface configuration.
# Copyright (C) 2006 by the Shorewall Team
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# See the file README.txt for further details.
#------------------------------------------------------------------------------
# For information about entries in this file, type "man shorewall-interfaces"
###############################################################################
{%- if pkg_version|float() >= 4.6 %}
  {% set format = '?FORMAT' %}
{%- else %}
  {% set format = 'FORMAT' %}
{%- endif %}
{{ format }} 2
###############################################################################
#ZONE   INTERFACE       OPTIONS

{%- for zone, zone_data in salt['pillar.get']('shorewall:zones', {}).iteritems() %}
{#    skip if ip version does not match #}
{%-   if zone_data.ipv is defined and zone_data.ipv != ipv %}{% continue %}{%endif %}
{%-   for interface, interface_data in zone_data.get('interfaces', {}).iteritems() %}
{#      skip if ip version does not match #}
{%-     if interface_data.ipv is defined and interface_data.ipv != ipv %}{% continue %}{%endif %}

# {{ interface }}
# {{ interface_data.comment if interface_data.comment is defined else '' }}
{%- if ipv == 6 %}
{{ zone }}  {{ interface }}  {{ interface_data.get('options', '').replace('arp_filter', '').replace(',,', ',').replace('arp_ignore', '').replace(',,', ',').replace('logmartians', '').replace(',,', ',').replace('nosmurfs', '').replace(',,', ',').replace('proxyarp', '').replace(',,', ',').replace('routefilter', '').replace(',,', ',') }}
{%- else %}
{{ zone }}  {{ interface }}  {{ interface_data.get('options', '') }}
{%- endif %}
{%-   endfor %}
{%- endfor %}
